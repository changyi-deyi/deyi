@{
    ViewBag.Title = "会员订单";
    WebManager.Model.ServiceOrderList_Model model = new WebManager.Model.ServiceOrderList_Model();
    if (Model != null)
    {
        model = Model;
    }
}

<script src="/assets/js/datetime/bs-datepicker.js"></script>
<script src="/Scripts/Order.js"></script>
<!-- 主要容器 -->
<div class="main-container container-fluid">
    <!-- Page Container -->
    <div class="page-container">
        <!-- 侧边导航 -->
        @Html.Partial("Sidebar", 6)
        <!-- /侧边导航 -->
        <!--右侧主体内容-->
        <div class="page-content">
            <div class="page-body">
                <div class="search-area clearfix">
                    <label class="pull-left font-weight-normal margin-right-10">
                        <input class="pull-left form-control no-border-r" type="text" placeholder="客户名称" id="txtSearchCustomerName" value="@(model.CustomerName)" />
                    </label>
                    <label class="pull-left font-weight-normal margin-right-10">
                        <input class="pull-left form-control no-border-r" type="text" placeholder="医生名称" id="txtSearchDoctorName" value="@(model.DoctorName)" />
                    </label>
                    <label class="pull-left font-weight-normal margin-right-10">
                        <input class="pull-left form-control no-border-r" type="text" placeholder="服务名称" id="txtSearchServiceName" value="@(model.ServiceName)" />
                    </label>
                    <label class="pull-left font-weight-normal margin-right-10">
                        <input class="pull-left form-control no-border-r" type="text" placeholder="开始时间" id="txtSearchSt" value="@(string.IsNullOrEmpty(model.StartDate) ? "": model.StartDate)" onclick="laydate({ istime: true, format: 'YYYY-MM-DD' })" />
                    </label>
                    <label class="pull-left font-weight-normal margin-right-10">
                        <input class="pull-left form-control no-border-r" type="text" placeholder="结束时间" id="txtSearchEt" value="@(string.IsNullOrEmpty(model.EndDate) ? "": model.EndDate)" onclick="laydate({ istime: true, format: 'YYYY-MM-DD' })" />
                    </label>
                    <label class="pull-left font-weight-normal margin-right-10">
                        <select class="pull-left form-control no-border-r" id="ddlSearchPaymentStatus">
                            <option value="0">请选择支付状态</option>
                            <option value="1">未支付</option>
                            <option value="2">定金支付</option>
                            <option value="3">已支付</option>
                            <option value="4">退款申请中</option>
                            <option value="5">已退款</option>
                            <option value="6">退款驳回</option>
                        </select>
                    </label>
                    <label class="pull-left font-weight-normal margin-right-10">
                        <select class="pull-left form-control no-border-r" id="ddlSearchOrderStatus">
                            <option value="0">请选择订单状态</option>
                            <option value="1">未完成</option>
                            <option value="2">已完成</option>
                            <option value="3">取消</option>
                            <option value="4">申请售后中</option>
                            <option value="5">售后完成</option>
                        </select>
                    </label>
                    <label class="pull-left font-weight-normal margin-right-10">
                        <select class="pull-left form-control no-border-r" id="ddlSearchServiceStatus">
                            <option value="0">请选择服务状态</option>
                            <option value="1">预约</option>
                            <option value="2">医生安排就绪</option>
                            <option value="3">患者确认</option>
                            <option value="4">服务进行中 </option>
                            <option value="5">服务完成</option>
                            <option value="9">取消</option>
                        </select>
                    </label>
                    <a class="btn-yellow pull-right btn-lg margin-right-10" onclick="ServiceOrderSearch('@(model.CustomerCode)')">搜 索</a>
                </div>
                <div id="data-table" class="list-content">
                    <table class="table table-striped table-hover">
                        <colgroup class="row">
                            <col class="col-lg-2">
                            <col class="col-lg-1">
                            <col class="col-lg-1">
                            <col class="col-lg-2">
                            <col class="col-lg-1">
                            <col class="col-lg-1">
                            <col class="col-lg-1">
                            <col class="col-lg-1">
                            <col class="col-lg-2">
                        </colgroup>
                        <thead>
                            <tr>
                                <th>订单编号</th>
                                <th>客户姓名</th>
                                <th>手机号码</th>
                                <th>服务名称</th>
                                <th>订单金额</th>
                                <th>服务状态</th>
                                <th>订单状态</th>
                                <th>支付状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (model.Data != null && model.Data.Count > 0)
                            {
                                foreach (Model.Manage_Model.ServiceOrder_Model item in model.Data)
                                {
                                    <tr>
                                        <td>@(item.OrderCode)</td>
                                        <td>@(item.CustomerName)</td>
                                        <td>@(item.Mobile)</td>
                                        <td>@(item.ServiceName)</td>
                                        <td>@(item.OrderAmount)</td>
                                        @switch (item.ServiceStatus)
                                        {
                                            case 1:
                                                <td>预约</td>
                                                break;
                                            case 2:
                                                <td>医生安排就绪</td>
                                                break;
                                            case 3:
                                                <td>患者确认</td>
                                                break;
                                            case 4:
                                                <td>服务进行中</td>
                                                break;
                                            case 5:
                                                <td>服务完成</td>
                                                break;
                                            case 9:
                                                <td>取消</td>
                                                break;
                                            default:
                                                <td></td>
                                                break;
                                        }

                                        @switch (item.OrderStatus)
                                        {
                                            case 1:
                                                <td>未完成</td>
                                                break;
                                            case 2:
                                                <td>已完成</td>
                                                break;
                                            case 3:
                                                <td>取消</td>
                                                break;
                                            case 4:
                                                <td>申请售后中</td>
                                                break;
                                            case 5:
                                                <td>售后完成</td>
                                                break;
                                            default:
                                                <td></td>
                                                break;
                                        }
                                        @switch (item.PaymentStatus)
                                        {
                                            case 1:
                                                <td>未支付</td>
                                                break;
                                            case 2:
                                                <td>定金支付</td>
                                                break;
                                            case 3:
                                                <td>已支付</td>
                                                break;
                                            case 4:
                                                <td>退款申请中</td>
                                                break;
                                            case 5:
                                                <td>已退款</td>
                                                break;
                                            case 6:
                                                <td>退款驳回</td>
                                                break;
                                            default:
                                                <td></td>
                                                break;
                                        }
                                        <td>
                                            <a class="btn-sm btn-green" href="/Order/ServiceOrderDetail?cd=@(item.OrderCode)">详细</a>
                                            @if (item.ServiceStatus == 1 && item.OrderStatus == 1)
                                            {
                                                <a class="btn-sm btn-green" onclick="UpdateServiceOrderStatus('@(item.OrderCode)',2)">医生确认</a>
                                            }
                                            else if (item.ServiceStatus == 2 && item.OrderStatus == 1)
                                            {
                                                <a class="btn-sm btn-green" onclick="UpdateServiceOrderStatus('@(item.OrderCode)',3)">客户确认</a>
                                            }
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>                   
                    <!--分页-->
                    <div class="row DTTTFooter padding-top-10">
                        <div class="col-sm-6 padding-top-10">
                            <div class="pull-left">
                                <select class="dropdown" style="width: 60px!important;" id="ddlRowsCount" onchange="changeRowCount('@("/Order/ServiceOrderList?cn=" + model.CustomerName + "&dn=" + model.DoctorName + "&sn=" + model.ServiceName + "&st=" + model.StartDate + "&et=" + model.EndDate + "&ss=" + model.ServiceStatus + "&os=" + model.OrderStatus + "&ps=" + model.PaymentStatus + "&cd=" + model.CustomerCode)')">
                                    <option value="10">10</option>
                                    <option value="20">20</option>
                                    <option value="30">30</option>
                                    <option value="50">50</option>
                                </select>
                            </div>
                            <div class="dataTables_info pull-left  margin-left-10" style="padding-top: 6px;">
                                <span class="orange margin-right-5">@(model.TotalCount == 0 ? 0 : model.PageCount)</span>/<span class="margin-left-5 margin-right-5">@(model.TotalPage)</span>,
                                共<span class="margin-left-5 margin-right-5">@(model.TotalCount)</span>条记录
                            </div>
                        </div>
                        <div class="col-sm-6 padding-top-10">
                            <div class="dataTables_paginate paging_bootstrap pull-right">
                                <ul class="pagination">
                                    @if (model.TotalCount > 0)
                                    {
                                        if (model.PageCount == 1)
                                        {
                                            <li class="prev disabled"><a>Prev</a></li>
                                        }
                                        else
                                        {
                                            <li class="prev"><a href="/Order/ServiceOrderList?cn=@(model.CustomerName)&dn=@(model.DoctorName)&sn=@(model.ServiceName)&st=@(model.StartDate)&et=@(model.EndDate)&ss=@(model.ServiceStatus)&os=@(model.OrderStatus)&ps=@(model.PaymentStatus)&cd=@(model.CustomerCode)&rc=@(model.RowsCount)&pc=@(model.PageCount-1)">Prev</a></li>
                                        }

                                        {
                                            int StartCount = 0;
                                            int EndCount = 0;
                                            if (model.TotalPage <= 5 || model.PageCount <= 3)
                                            {
                                                StartCount = 1;
                                                EndCount = model.TotalPage > 5 ? 5 : model.TotalPage;

                                                int showPageCount = model.TotalPage > 5 ? 5 : model.TotalPage;

                                            }
                                            else
                                            {
                                                if (model.PageCount > model.TotalPage - 2)
                                                {

                                                    StartCount = model.TotalPage - 4;
                                                    EndCount = model.TotalPage;
                                                }
                                                else
                                                {
                                                    StartCount = model.PageCount - 2;
                                                    EndCount = model.PageCount + 2;

                                                }
                                            }

                                            for (var i = StartCount; i <= EndCount; i++)
                                            {
                                                <li @(i == model.PageCount ? "class=active" : "")><a href="/Order/ServiceOrderList?cn=@(model.CustomerName)&dn=@(model.DoctorName)&sn=@(model.ServiceName)&st=@(model.StartDate)&et=@(model.EndDate)&ss=@(model.ServiceStatus)&os=@(model.OrderStatus)&ps=@(model.PaymentStatus)&cd=@(model.CustomerCode)&rc=@(model.RowsCount)&pc=@(i)">@(i)</a></li>
                                            }

                                        }


                                        if (model.PageCount == model.TotalPage)
                                        {
                                            <li class="next disabled"><a>Next</a></li>
                                        }
                                        else
                                        {
                                            <li class="next"><a href="/Order/ServiceOrderList?cn=@(model.CustomerName)&dn=@(model.DoctorName)&sn=@(model.ServiceName)&st=@(model.StartDate)&et=@(model.EndDate)&ss=@(model.ServiceStatus)&os=@(model.OrderStatus)&ps=@(model.PaymentStatus)&cd=@(model.CustomerCode)&rc=@(model.RowsCount)&pc=@(model.PageCount+1)">Next</a></li>
                                        }
                                    }
                                </ul>
                            </div>

                        </div>
                    </div>
                    <!--/ 分页-->
                </div>
            </div>
        </div>
        <!--datacontent end-->
    </div>
    <!--右侧主体内容 结束-->
</div>
</div>

<input type="hidden" id="txtHidden" />
<script>
    $(function () {
        $("#txtHidden").data("PageCount", @(model.PageCount));
        $("#ddlRowsCount").val(@(model.RowsCount));
        $("#ddlSearchPaymentStatus").val(@(model.PaymentStatus));
        $("#ddlSearchOrderStatus").val(@(model.OrderStatus));
        $("#ddlSearchServiceStatus").val(@(model.ServiceStatus));
    });
</script>
